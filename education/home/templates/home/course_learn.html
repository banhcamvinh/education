<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>simplecode</title>
    <link rel="stylesheet" href="{% static 'home/assets/bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface&amp;display=swap">
    <link rel="stylesheet" href="{% static 'home/assets/css/FontAwesome.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:400,600,800">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,700&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,400i,700,700i">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,400&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700">
    <link rel="stylesheet" href="{% static 'home/assets/fonts/fontawesome-all.min.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/fonts/font-awesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/fonts/fontawesome5-overrides.min.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/--mp---Multiple-items-slider-responsive.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/4-Col-Small-Slider.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/404-NOT-FOUND-animated.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Accordion-3338arvorept-1.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Accordion-3338arvorept.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/best-carousel-slide-1.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/best-carousel-slide.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Brands.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/circle-progress-bar.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Features-Clean.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Footer-Dark.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Header-Blue.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Highlight-Phone.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.10.0/baguetteBox.min.css">
    <link rel="stylesheet" href="{% static 'home/assets/css/Lightbox-Gallery.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Ludens-Users---1-Login.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Ludens-Users---2-Register.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Media-Slider-Bootstrap-3-1.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Media-Slider-Bootstrap-3.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/MUSA_carousel-product-cart-slider-1.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/MUSA_carousel-product-cart-slider.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Navigation-with-Button.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Newsletter-Subscription-Form.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Pretty-Product-List.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Search-Input-Responsive-with-Icon.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Steps-Progressbar.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/sticky-dark-top-nav.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Swipe-Slider-7.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Team-Boxed.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Testimonials.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Ultimate-Testimonial-Slider-BS5.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/User-Rating-F19690.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets/css/Video-Responsive-YouTube.css' %}">
</head>
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
{% if auto_submit_lesson %}
<form method="get" id="lesson_form" name="lesson_form">
    <input style="display: none;" name="lesson" value="{{cur_lesson}}" type="text">
    <h1>Đang chuyển đến bài bạn đang học</h1>
</form>
{% else %} 
<body>
    <!-- <iframe id="youtube_video" allowfullscreen="" frameborder="0" src="https://firebasestorage.googleapis.com/v0/b/education-5dcf4.appspot.com/o/test?alt=media&token=8ec574b6-6fc2-4861-89d6-a0d785db415c" height="0" style="width: 100%;height: 600px;"></iframe> -->
    <video id="myvideo" width="100%" style="height: 600px;" controls>
        <source src="https://firebasestorage.googleapis.com/v0/b/education-5dcf4.appspot.com/o/test?alt=media&token=8ec574b6-6fc2-4861-89d6-a0d785db415c" type="video/mp4">
    </video>
    <div class="container">
        <div class="row">
            <div class="col">
                <h1>Tên bài học</h1>
                <div class="steps-progressbar">
                    <ul>
                        {% with ''|center:part_count as range %}
                        {% if not range %}
                        {% endif %}
                        {% for _ in range %}
                            {% if forloop.counter < finish_part %}
                            <li class="previous">Chương {{forloop.counter}}</li>
                            {% endif %}
                            {% if  forloop.counter == finish_part %}
                            <li class="active">Chương {{forloop.counter}}</li>
                            {% endif %}
                            {% if  forloop.counter > finish_part %}
                            <li>Chương {{forloop.counter}}</li>
                            {% endif %}
                        {% endfor %}
                        {% endwith %}
                    </ul>
                </div>
                <div class="steps-progressbar">
                    <ul>
                        {% with ''|center:lesson_count as range %}
                        {% if not range %}
                        {% endif %}
                        {% for _ in range %}
                            {% if forloop.counter < finish_lesson %}
                            <li class="previous">Bài {{forloop.counter}}</li>
                            {% endif %}
                            {% if  forloop.counter == finish_lesson %}
                            <li class="active">Bài {{forloop.counter}}</li>
                            {% endif %}
                            {% if  forloop.counter > finish_lesson %}
                            <li>Bài {{forloop.counter}}</li>
                            {% endif %}
                        {% endfor %}
                        {% endwith %}
                    </ul>
                </div>
                {% if is_finish_course == True%}
                <a href="/course_certificate/{{course_id}}" class="btn btn-primary" style="width: 100%;">Hoàn thành khóa học</a>
                {% else %}
                <button  disabled class="btn btn-primary" style="width: 100%;">Hoàn thành khóa học</button>
                {% endif %}
                <p style="font-size: 30px; margin-top: 10px;">Thêm ghi chú cho bài học</p>
            </div>
            <div class="col-md-12">
                <textarea id="create_note_textarea" style="width: 100%;height: 100px;"></textarea>
                <button id="create_note_btn" class="btn btn-primary" type="button">Note</button>
            </div>
            <form name="main_form" method="get">
                <input style="display: none;" type="text" name="note">
            </form>
        </div>
        <div class="row">
            <div id='notion_area' class="col" style="overflow-y: scroll; height: 500px;">
                <h2> Danh sách ghi chú của bài học</h2>
                {% if not notion_list %}
                <p>Chưa có ghi chú nào</p>
                {% endif %}
                {% for el in notion_list %}
                <div class="row">
                    <div class="col">
                        <h1 index="{{ forloop.counter0 }}">{{ el.video_time }}</h1>
                        <textarea index="{{ forloop.counter0 }}" id="note" disabled style="width: 100%;height: 100px;">{{el.note}}</textarea>
                        <p index="{{ forloop.counter0 }}" class="temp" style="display: none;"></p>
                        <button index="{{ forloop.counter0 }}" class="edit btn btn-primary" type="button">Edit</button>
                        <button index="{{ forloop.counter0 }}" class="delete btn btn-primary" type="button">Xóa</button>
                        <button index="{{ forloop.counter0 }}" style="display: none;" class="ok btn btn-primary" type="button">Ok</button>
                        <button index="{{ forloop.counter0 }}" style="display: none;" class="cancel btn btn-primary" type="button">Hủy</button>
                    </div>
                </div>
                {% endfor %}
                <!-- <div class="row">
                    <div class="col">
                        <h1>Heading</h1><textarea style="width: 100%;height: 100px;"></textarea><button class="btn btn-primary" type="button">Edit</button><button class="btn btn-primary" type="button">Xóa</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <h1>Heading</h1><textarea style="width: 100%;height: 100px;"></textarea><button class="btn btn-primary" type="button">Edit</button><button class="btn btn-primary" type="button">Xóa</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <h1>Heading</h1><textarea style="width: 100%;height: 100px;"></textarea><button class="btn btn-primary" type="button">Edit</button><button class="btn btn-primary" type="button">Xóa</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <h1>Heading</h1><textarea style="width: 100%;height: 100px;"></textarea><button class="btn btn-primary" type="button">Edit</button><button class="btn btn-primary" type="button">Xóa</button>
                    </div>
                </div> -->
            </div>
            <div class="col-xxl-6">
                <div class="accordion" id="accordionPart">
                    {% for part,part_detail in part_dict.items  %}
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingPart{{forloop.counter}}">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePart{{forloop.counter}}" aria-expanded="false" aria-controls="collapsePart{{forloop.counter}}">
                            Chương {{forloop.counter}}: {{part}}
                            </button>
                        </h2>
                        <div id="collapsePart{{forloop.counter}}" class="accordion-collapse collapse show" aria-labelledby="headingPart{{forloop.counter}}" data-bs-parent="#accordionPart">
                            <div class="accordion-body">

                                <div class="accordion" id="accordionLesson">
                                    {% for lesson,lesson_detail in part_detail.items  %}
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingLesson{{forloop.counter}}">
                                            <a href="/{{course_id}}?={{lesson}}" style="font-size: 10px;">Truy cập {{ lesson }}</a>
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseLesson{{forloop.counter}}" aria-expanded="false" aria-controls="collapseLesson{{forloop.counter}}">
                                            {% if forloop.counter <= finish_lesson and forloop.parentloop.counter <= finish_part and not_start == True %}
                                                <input type="checkbox" checked disabled>
                                            {% else %}
                                                <input type="checkbox" disabled>
                                            {% endif %}
                                            Bài {{forloop.counter}}: {{lesson}}
                                            </button>
                                        </h2>
                                        <div id="collapseLesson{{forloop.counter}}" class="accordion-collapse collapse show" aria-labelledby="headingLesson{{forloop.counter}}" data-bs-parent="#accordionLesson">
                                            <div class="accordion-body">
                                                
                                                <div class="accordion" id="accordionQuestion">
                                                    Bài tập
                                                    {% for question in lesson_detail.question_list  %}
                                                    <div class="accordion-item">
                                                        <h2 class="accordion-header" id="headingQuestion{{forloop.counter}}">
                                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseQuestion{{forloop.counter}}" aria-expanded="false" aria-controls="collapseQuestion{{forloop.counter}}">
                                                            Câu hỏi {{forloop.counter}}: {{question}}
                                                            </button>
                                                        </h2>
                                                        <!-- <div id="collapseQuestion{{forloop.counter}}" class="accordion-collapse collapse show" aria-labelledby="headingQuestion{{forloop.counter}}" data-bs-parent="#accordionQuestion">
                                                            <div class="accordion-body">
                                                                
                                
                                                            </div>
                                                        </div> -->
                                                    </div>
                                                    {% endfor %} 
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %} 
                                </div>


                            </div>
                        </div>
                    </div>
                    {% endfor %} 
                </div>
            </div>
        </div>
    </div>
    <script src="{% static 'home/assets/bootstrap/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'home/assets/js/bs-init.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.10.0/baguetteBox.min.js"></script>
    <script src="{% static 'home/assets/js/--mp---Multiple-items-slider-responsive-1.js' %}"></script>
    <script src="{% static 'home/assets/js/--mp---Multiple-items-slider-responsive.js' %}"></script>
    <script src="{% static 'home/assets/js/Accordion-3338arvorept.js' %}"></script>
    <script src="{% static 'home/assets/js/Counting.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick.js"></script>
    <script src="https://code.jquery.com/jquery-2.2.0.min.js&quot; type=&quot;text/javascript"></script>
    <script src="{% static 'home/assets/js/Lightbox-Gallery.js' %}"></script>
    <script src="{% static 'home/assets/js/Media-Slider-Bootstrap-3.js' %}"></script>
    <script src="{% static 'home/assets/js/Swipe-Slider-7.js' %}"></script>
    <script src="{% static 'home/assets/js/Ultimate-Testimonial-Slider-BS5.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
</body>
{% endif %} 

<script>
    {% if auto_submit_lesson %}
    window.onload = function(){
        document.forms['lesson_form'].submit();
    }
    {% endif %}



    let create_note_textarea = document.querySelector('#create_note_textarea')
    let create_note_btn = document.querySelector('#create_note_btn')
    let notion_area = document.querySelector('#notion_area')
    let note_list_el = document.querySelectorAll('#note')
    let note_list = []
    let note_time_list_el = document.querySelectorAll('#notion_area h1')
    let note_time_list = []
    note_time_list_el.forEach(el =>{
        note_time_list.push(el.innerText)
    })
    note_list_el.forEach(el =>{
        note_list.push(el.value)
    })
    var cur_time = {{ watching_time }}
    var cur_lesson = "{{ cur_lesson }}"

    cur_hhmmss = new Date(cur_time * 1000).toISOString().substr(11, 8)
    video = document.querySelector('#myvideo')
    video.currentTime = cur_time
    video.ontimeupdate = function() {timeupdate()};
    window.addEventListener('beforeunload', (event) => {
        event.preventDefault();
        // Bắn vào database để ghi lại event
    });
    function timeupdate(){
        note_list_el = document.querySelectorAll('#note')
        note_time_list_el = document.querySelectorAll('#notion_area h1')        
        cur_time = video.currentTime
        cur_hhmmss = new Date(cur_time * 1000).toISOString().substr(11, 8)
        if ( note_time_list.includes(cur_hhmmss.toString()) ){
            index = note_time_list.indexOf(cur_hhmmss.toString())
            create_note_textarea.value = note_list[index]
        }else{
            create_note_textarea.value = ""
        }
    }
    // Pasue video khi người dùng bắt tay vào note 
    create_note_textarea.addEventListener('focus',(event)=>{
        video.pause();
    })
    // Khi edit note đã tạo
    let edit_note_btn_list_el =  document.querySelectorAll('button.edit')
    let delete_note_btn_list_el =  document.querySelectorAll('button.delete')
    let ok_note_btn_list_el =  document.querySelectorAll('button.ok')
    let cancel_note_btn_list_el =  document.querySelectorAll('button.cancel')
    let temp_list_el = document.querySelectorAll('p.temp')

    edit_note_btn_list_el.forEach((el,index)=>{
        el.addEventListener('click',event=>{
            note_list_el[index].disabled = false
            edit_note_btn_list_el[index].style.display = "none"
            delete_note_btn_list_el[index].style.display = "none"
            ok_note_btn_list_el[index].style.display = "inline-block"
            cancel_note_btn_list_el[index].style.display = "inline-block"
            temp_list_el[index].innerText = note_list_el[index].value
        })
    })
    cancel_note_btn_list_el.forEach((el,index)=>{
        el.addEventListener('click',event=>{
            note_list_el[index].disabled = true
            note_list_el[index].value = temp_list_el[index].innerText
            edit_note_btn_list_el[index].style.display = "inline-block"
            delete_note_btn_list_el[index].style.display = "inline-block"
            ok_note_btn_list_el[index].style.display = "none"
            cancel_note_btn_list_el[index].style.display = "none"
        })
    })
    ok_note_btn_list_el.forEach((el,index)=>{
        el.addEventListener('click',event=>{
            note_list_el[index].disabled = true
            note_list[index] = note_list_el[index].value
            edit_note_btn_list_el[index].style.display = "inline-block"
            delete_note_btn_list_el[index].style.display = "inline-block"
            ok_note_btn_list_el[index].style.display = "none"
            cancel_note_btn_list_el[index].style.display = "none"
            const [hours, minutes, seconds] =  note_time_list[index].split(':');
            const totalSeconds = (+hours) * 60 * 60 + (+minutes) * 60 + (+seconds);
            time = totalSeconds
            $.ajax({
                url: '/course_learn/{{course_id}}',
                type: "POST",
                dataType: "json",
                data: JSON.stringify({time: time,note: note_list[index],cur_lesson:cur_lesson}),
                headers: {
                    "X-Requested-With": "XMLHttpRequest",
                },
                success: (data) => {
                },
                error: (error) => {
                    console.log(error);
                }
            });
            // Update lại khung note
            create_note_textarea.value = ''
            video.currentTime = video.currentTime + 1
            video.currentTime = video.currentTime - 1
        })
    })
    delete_note_btn_list_el.forEach((el,index)=>{
        el.addEventListener('click',event=>{
            temp_list_el = document.querySelectorAll('p.temp')
            element = event.target.parentElement.parentElement
            element.remove()
            const [hours, minutes, seconds] =  note_time_list[index].split(':');
            const totalSeconds = (+hours) * 60 * 60 + (+minutes) * 60 + (+seconds);
            del_time = totalSeconds
            note_list_el = document.querySelectorAll('#note')
            note_time_list_el = document.querySelectorAll('#notion_area h1')
            note_list.splice(index,1);
            edit_note_btn_list_el =  document.querySelectorAll('button.edit')
            delete_note_btn_list_el =  document.querySelectorAll('button.delete')
            ok_note_btn_list_el =  document.querySelectorAll('button.ok')
            cancel_note_btn_list_el =  document.querySelectorAll('button.cancel')
            note_time_list_el = document.querySelectorAll('#notion_area h1')
            note_list_el = document.querySelectorAll('#note')
            p_list_el = document.querySelectorAll('p.temp')

            edit_note_btn_list_el.forEach((el,index)=>{
                el.setAttribute('index',index)
            })
            delete_note_btn_list_el.forEach((el,index)=>{
                el.setAttribute('index',index)
            })
            ok_note_btn_list_el.forEach((el,index)=>{
                el.setAttribute('index',index)
            })
            cancel_note_btn_list_el.forEach((el,index)=>{
                el.setAttribute('index',index)
            })
            note_time_list_el.forEach((el,index)=>{
                el.setAttribute('index',index)
            })
            note_list_el.forEach((el,index)=>{
                el.setAttribute('index',index)
            })
            p_list_el.forEach((el,index)=>{
                el.setAttribute('index',index)
            })

            note_time_list.splice(index,1);
            $.ajax({
                url: '/course_learn/{{course_id}}',
                type: "POST",
                dataType: "json",
                data: JSON.stringify({time: del_time,note: '',cur_lesson:cur_lesson}),
                headers: {
                    "X-Requested-With": "XMLHttpRequest",
                },
                success: (data) => {
                },
                error: (error) => {
                    console.log(error);
                }
            });
            // Update lại khung note
            create_note_textarea.value = ''
            video.currentTime = video.currentTime + 1
            video.currentTime = video.currentTime - 1
        })
    })


    // eveent create note ( nếu đã có hoặc chưa có)
    create_note_btn.addEventListener('click',event=>{
        if (create_note_textarea.value == ''){return;}
        if ( note_time_list.includes(cur_hhmmss.toString()) ){
            index_input = note_time_list.indexOf(cur_hhmmss.toString())
            note_list_el.forEach((note, index)=>{
                if (index == index_input){
                    note.value = create_note_textarea.value;
                    note_list[index] = create_note_textarea.value;
                }
            });
        }
        else{
            index = note_list.length
            row = document.createElement('div')
            row.classList.add('row')
            col = document.createElement('div')
            col.classList.add('col')
            h1 = document.createElement('h1')
            h1.innerText = new Date(cur_time * 1000).toISOString().substr(11, 8)
            textarea = document.createElement('textarea')
            textarea.setAttribute('id','note');
            textarea.disabled = true
            textarea.style.width = '100%'
            textarea.style.height = '100px'
            textarea.value = create_note_textarea.value
            p = document.createElement('p')
            p.setAttribute('class','temp')
            p.style.display = 'none'

            edit_btn = document.createElement('button')
            edit_btn.className += 'edit'
            edit_btn.className += ' btn'
            edit_btn.className += ' btn-primary'
            edit_btn.innerText = 'Edit'
            delete_btn = document.createElement('button')
            delete_btn.className += 'delete'
            delete_btn.className += ' btn'
            delete_btn.className += ' btn-primary'
            delete_btn.innerText = 'Xóa'
            ok_btn = document.createElement('button')
            ok_btn.className += 'ok'
            ok_btn.className += ' btn'
            ok_btn.className += ' btn-primary'
            ok_btn.innerText = 'OK'
            ok_btn.style.display = 'none'
            cancel_btn = document.createElement('button')
            cancel_btn.className += 'cancel'
            cancel_btn.className += ' btn'
            cancel_btn.className += ' btn-primary'
            cancel_btn.innerText = 'Hủy'
            cancel_btn.style.display = 'none'
            h1.setAttribute('index',index)
            textarea.setAttribute('index',index)
            p.setAttribute('index',index)
            edit_btn.setAttribute('index',index)
            delete_btn.setAttribute('index',index)
            ok_btn.setAttribute('index',index)
            cancel_btn.setAttribute('index',index)

            col.appendChild(h1)
            col.appendChild(textarea)
            col.appendChild(p)
            col.appendChild(edit_btn)
            col.appendChild(delete_btn)
            col.appendChild(ok_btn)
            col.appendChild(cancel_btn)
            row.appendChild(col)
            notion_area.appendChild(row)
            note_list.push(create_note_textarea.value)
            note_time_list.push(cur_hhmmss)

            edit_note_btn_list_el =  document.querySelectorAll('button.edit')
            delete_note_btn_list_el =  document.querySelectorAll('button.delete')
            ok_note_btn_list_el =  document.querySelectorAll('button.ok')
            cancel_note_btn_list_el =  document.querySelectorAll('button.cancel')
            temp_list_el = document.querySelectorAll('p.temp')


            edit_btn.addEventListener('click',event=>{
                index = parseInt(event.target.getAttribute('index'))
                note_list_el[index].disabled = false
                edit_note_btn_list_el[index].style.display = "none"
                delete_note_btn_list_el[index].style.display = "none"
                ok_note_btn_list_el[index].style.display = "inline-block"
                cancel_note_btn_list_el[index].style.display = "inline-block"
                temp_list_el[index].innerText = note_list_el[index].value
            })
            cancel_btn.addEventListener('click',event=>{
                index = parseInt(event.target.getAttribute('index'))
                note_list_el[index].disabled = true
                note_list_el[index].value = temp_list_el[index].innerText
                edit_note_btn_list_el[index].style.display = "inline-block"
                delete_note_btn_list_el[index].style.display = "inline-block"
                ok_note_btn_list_el[index].style.display = "none"
                cancel_note_btn_list_el[index].style.display = "none"
            })
            ok_btn.addEventListener('click',event=>{
                index = parseInt(event.target.getAttribute('index'))
                note_list_el[index].disabled = true
                note_list[index] = note_list_el[index].value
                edit_note_btn_list_el[index].style.display = "inline-block"
                delete_note_btn_list_el[index].style.display = "inline-block"
                ok_note_btn_list_el[index].style.display = "none"
                cancel_note_btn_list_el[index].style.display = "none"
                const [hours, minutes, seconds] =  note_time_list[index].split(':');
                const totalSeconds = (+hours) * 60 * 60 + (+minutes) * 60 + (+seconds);
                time = totalSeconds
                $.ajax({
                    url: '/course_learn/{{course_id}}',
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify({time: time,note: note_list[index],cur_lesson:cur_lesson}),
                    headers: {
                        "X-Requested-With": "XMLHttpRequest",
                    },
                    success: (data) => {
                    },
                    error: (error) => {
                        console.log(error);
                    }
                });
                // Update lại khung note
                create_note_textarea.value = ''
                video.currentTime = video.currentTime + 1
                video.currentTime = video.currentTime - 1
            })
            delete_btn.addEventListener('click',event=>{
                temp_list_el = document.querySelectorAll('p.temp')
                index = parseInt(event.target.getAttribute('index'))
                element = event.target.parentElement.parentElement
                element.remove()
                const [hours, minutes, seconds] =  note_time_list[index].split(':');
                const totalSeconds = (+hours) * 60 * 60 + (+minutes) * 60 + (+seconds);
                del_time = totalSeconds
                note_list_el = document.querySelectorAll('#note')
                note_time_list_el = document.querySelectorAll('#notion_area h1')
                note_list.splice(index,1);
                note_time_list.splice(index,1);
                edit_note_btn_list_el =  document.querySelectorAll('button.edit')
                delete_note_btn_list_el =  document.querySelectorAll('button.delete')
                ok_note_btn_list_el =  document.querySelectorAll('button.ok')
                cancel_note_btn_list_el =  document.querySelectorAll('button.cancel')
                note_time_list_el = document.querySelectorAll('#notion_area h1')
                note_list_el = document.querySelectorAll('#note')
                p_list_el = document.querySelectorAll('p.temp')
                edit_note_btn_list_el.forEach((el,index)=>{
                    el.setAttribute('index',index)
                })
                delete_note_btn_list_el.forEach((el,index)=>{
                    el.setAttribute('index',index)
                })
                ok_note_btn_list_el.forEach((el,index)=>{
                    el.setAttribute('index',index)
                })
                cancel_note_btn_list_el.forEach((el,index)=>{
                    el.setAttribute('index',index)
                })
                note_time_list_el.forEach((el,index)=>{
                    el.setAttribute('index',index)
                })
                note_list_el.forEach((el,index)=>{
                    el.setAttribute('index',index)
                })
                p_list_el.forEach((el,index)=>{
                    el.setAttribute('index',index)
                })

                $.ajax({
                    url: '/course_learn/{{course_id}}',
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify({time: del_time,note: '',cur_lesson:cur_lesson}),
                    headers: {
                        "X-Requested-With": "XMLHttpRequest",
                    },
                    success: (data) => {
                    },
                    error: (error) => {
                        console.log(error);
                    }
                });
                // Update lại khung note
                create_note_textarea.value = ''
                video.currentTime = video.currentTime + 1
                video.currentTime = video.currentTime - 1
            })
        
        }
        // Bắn dữ liệu cho backend
        $.ajax({
            url: '/course_learn/{{course_id}}',
            type: "POST",
            dataType: "json",
            data: JSON.stringify({time: cur_time,note: create_note_textarea.value,cur_lesson:cur_lesson }),
            headers: {
                "X-Requested-With": "XMLHttpRequest",
            },
            success: (data) => {
            },
            error: (error) => {
                console.log(error);
            }
        });
        // Update lại khung note
        create_note_textarea.value = ''
        video.currentTime = video.currentTime + 1
        video.currentTime = video.currentTime - 1
    })


</script>

</html>